<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

    <title>ChildCara 상세페이지</title>
    <script>
        function apply() {
            let title_give = $('#apply-title').text()
            $.ajax({
                type: "POST",
                url: "/detail",
                data: {title_give: title_give},
                success: function (response) {
                    alert(response["msg"]);
                    window.location.reload();
                }
            })
        }

        function cancel() {
            let username = "{{ user_info.username }}"
            let title_give = $('#apply-title').text()
            $.ajax({
                type: "UPDATE",
                url: "/detail",
                data: {title_give: title_give, cancel_name: username},
                success: function (response) {
                    alert(response["msg"]);
                    window.location.reload();
                }
            })
        }

        function delete_post() {
            let title = $('#apply-title').text()
            $.ajax({
                type: "DELETE",
                url: "/detail",
                data: {title_give: title},
                success: function (response) {
                    alert(response["msg"]);
                    window.location.href = "/";
                }
            })
        }
    </script>
    <style>
        .card {
            width: 700px;
            height: 500px;
            margin-top: 150px;
            margin-left: 450px;
        }

        .btn-primary {
            margin-top: 30px;
            margin-left: 750px;
        }

        .input-group {
            height: 20%;
        }

        .btn-update {
            position: absolute;
            margin-left: 63%;
            top: 110px;
        }

        .btn-delete {
            position: absolute;
            margin-left: 69%;
            top: 110px;
        }
    </style>
</head>

<body>

{%if user_info.username == post_info %}
<button type="button" class="btn btn-update btn-link" onclick="window.location.href='/postingPage'">수정하기</button>
<button type="button" class="btn btn-delete btn-link" onclick="delete_post()">삭제하기</button>
{% endif %}
<div class="card">
    <div class="input-group">
        <div class="input-group-prepend">
            <div class="input-group-text" id="btnGroupAddon">제목</div>
        </div>
        <span type="text" class="form-control" id="apply-title">{{title}}</span>

        <div class="input-group mb-4">
            <div>
                <span class="input-group-text" id="basic-addon1">작성자</span>
            </div>
            <span class="form-control">{{post_info}}</span>
            <div>
                <span class="input-group-text" id="basic-addon2">지역</span>
            </div>
            <span class="form-control">{{location}}</span>
            <div>
                <span class="input-group-text" id="basic-addon3">모집인원</span>
            </div>
            {% if cur_cnt == population %}
            <span class="form-control">모집완료</span>
            {% else %}
            <span class="form-control">({{cur_cnt}}/{{population}})명</span>
            {% endif %}
        </div>
        <div class="input-group mb-3">
            <div>
                <span class="input-group-text" id="basic-addon4">나이</span>
            </div>
            <span class="form-control">{{age}}</span>
            <div>
                <span class="input-group-text" id="basic-addon5">전화번호</span>
            </div>
            <span class="form-control">{{phone}}</span>

        </div>
        <div class="card-body">
            <p class="card-text">{{details}}</p>
        </div>
    </div>
</div>

{% set check = {'dupli': True} %}
{% for na in apply_info %}
    {% if (user_info.username == na) and (check.update({'dupli': False})) %}
    {% endif %}
{% endfor %}
{% if check.dupli == True %}
    <button onclick="apply()" class="btn-primary">신청하기</button>
{% else %}
    <button onclick="cancel()" class="btn-primary">취소하기</button>
{% endif %}

<button class="btn-primary" onclick="window.location.href='/'">메인으로</button>

</body>


</html>

